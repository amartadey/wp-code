<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WP Troubleshooting Code Hub</title>
    <script src="https://code.iconify.design/3/3.1.0/iconify.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
            padding: 20px;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .subtitle {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .search-box {
            background: white;
            border-radius: 50px;
            padding: 15px 25px;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .search-box input {
            border: none;
            outline: none;
            flex: 1;
            font-size: 16px;
        }

        .categories {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 30px;
            justify-content: center;
        }

        .category-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid rgba(255,255,255,0.3);
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .category-btn:hover, .category-btn.active {
            background: white;
            color: #667eea;
            transform: translateY(-2px);
        }

        .snippets-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .snippet-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
            display: flex;
            flex-direction: column;
        }

        .snippet-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .snippet-header {
            display: flex;
            align-items: start;
            gap: 15px;
            margin-bottom: 15px;
        }

        .snippet-icon {
            font-size: 32px;
            color: #667eea;
            flex-shrink: 0;
        }

        .snippet-title {
            flex: 1;
        }

        .snippet-title h3 {
            color: #2d3748;
            font-size: 1.2em;
            margin-bottom: 5px;
        }

        .snippet-category {
            display: inline-block;
            background: #e6f0ff;
            color: #667eea;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .snippet-description {
            color: #4a5568;
            margin-bottom: 15px;
            line-height: 1.6;
            flex: 1;
        }

        .code-block {
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            overflow-x: auto;
            position: relative;
            margin-bottom: 10px;
        }

        .code-block pre {
            margin: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .copy-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: background 0.3s;
            align-self: flex-start;
        }

        .copy-btn:hover {
            background: #5568d3;
        }

        .copy-btn.copied {
            background: #48bb78;
        }

        .no-results {
            text-align: center;
            color: white;
            font-size: 1.2em;
            padding: 40px;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.8em;
            }
            
            .snippets-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>
                <span class="iconify" data-icon="logos:wordpress-icon"></span>
                WP Troubleshooting Hub
            </h1>
            <p class="subtitle">Essential WordPress code snippets for debugging custom projects</p>
        </header>

        <div class="search-box">
            <span class="iconify" data-icon="carbon:search" style="color: #667eea; font-size: 20px;"></span>
            <input type="text" id="searchInput" placeholder="Search snippets...">
        </div>

        <div class="categories">
            <button class="category-btn active" data-category="all">
                <span class="iconify" data-icon="carbon:grid"></span>
                All
            </button>
            <button class="category-btn" data-category="debug">
                <span class="iconify" data-icon="carbon:debug"></span>
                Debug
            </button>
            <button class="category-btn" data-category="templates">
                <span class="iconify" data-icon="carbon:document"></span>
                Templates
            </button>
            <button class="category-btn" data-category="hooks">
                <span class="iconify" data-icon="carbon:flow"></span>
                Hooks
            </button>
            <button class="category-btn" data-category="database">
                <span class="iconify" data-icon="carbon:data-base"></span>
                Database
            </button>
            <button class="category-btn" data-category="user">
                <span class="iconify" data-icon="carbon:user"></span>
                User
            </button>
            <button class="category-btn" data-category="performance">
                <span class="iconify" data-icon="carbon:dashboard"></span>
                Performance
            </button>
        </div>

        <div class="snippets-grid" id="snippetsGrid"></div>
        <div class="no-results" id="noResults" style="display: none;">No snippets found</div>
    </div>

    <script>
        const snippets = [
            
            {
        title: "Which Template is Being Used?",
        category: "templates",
        icon: "carbon:document-view",
        description: "Display the current template file being loaded in the page source (visible only to administrators).",
        code: `add_action('wp_head', function() {
    if (current_user_can('administrator')) {
        global $template;
        echo '';
    }
});`
    },
    {
        title: "Enable WP Debug Mode (wp-config.php)",
        category: "debug",
        icon: "carbon:debug",
        description: "Add to wp-config.php to enable debug mode and log errors to debug.log file.",
        code: `define('WP_DEBUG', true);
define('WP_DEBUG_LOG', true);
define('WP_DEBUG_DISPLAY', false);
@ini_set('display_errors', 0);`
    },
    {
        title: "Show All Registered Hooks",
        category: "hooks",
        icon: "carbon:flow",
        description: "Display all hooks that have been registered on the current page (heavy, use with caution).",
        code: `add_action('wp_footer', function() {
    if (current_user_can('administrator')) {
        global $wp_filter;
        echo '<pre>';
        print_r(array_keys($wp_filter)); // Only prints hook names for better performance
        echo '</pre>';
    }
});`
    },
    {
        title: "Display Query Variables",
        category: "debug",
        icon: "carbon:search",
        description: "Show the current WP_Query variables for debugging query issues.",
        code: `add_action('wp_footer', function() {
    if (current_user_can('administrator')) {
        global $wp_query;
        echo '';
    }
});`
    },
    {
        title: "Log Database Queries (wp-config.php + PHP)",
        category: "database",
        icon: "carbon:data-base",
        description: "Enable query logging in wp-config and display queries at the footer (heavy).",
        code: `// Add to wp-config.php
define('SAVEQUERIES', true);

// Add to theme's functions.php
add_action('wp_footer', function() {
    if (current_user_can('administrator') && defined('SAVEQUERIES') && SAVEQUERIES) {
        global $wpdb;
        echo '';
        echo '<pre style="max-height: 300px; overflow: auto;">';
        foreach($wpdb->queries as $query) {
             echo esc_html($query[0]) . ' (' . $query[1] . 's) \n\n';
        }
        echo '</pre>';
    }
});`
    },
    {
        title: "Show Template Hierarchy Paths",
        category: "templates",
        icon: "carbon:tree-view",
        description: "Display the files WordPress is looking for during the template loading process.",
        code: `add_filter('template_include', function($template) {
    if (current_user_can('administrator')) {
        global $wp_query;
        $files = array_filter( $wp_query->get_template_handlers(), 'file_exists' );
        echo '';
        echo '';
    }
    return $template;
});`
    },
    {
        title: "Display Current User Roles",
        category: "user",
        icon: "carbon:user-role",
        description: "Show all roles for the current logged-in user.",
        code: `add_action('wp_footer', function() {
    if (is_user_logged_in() && current_user_can('administrator')) {
        $user = wp_get_current_user();
        echo '';
    }
});`
    },
    {
        title: "Show Registered Menus",
        category: "templates",
        icon: "carbon:menu",
        description: "Display all registered navigation menus and their locations.",
        code: `add_action('wp_footer', function() {
    if (current_user_can('administrator')) {
        $menus = get_registered_nav_menus();
        echo '';
    }
});`
    },
    {
        title: "Display Enqueued Scripts & Styles",
        category: "debug",
        icon: "carbon:code",
        description: "List the handles of all enqueued scripts and stylesheets on the current page.",
        code: `add_action('wp_footer', function() {
    if (current_user_can('administrator')) {
        global $wp_scripts, $wp_styles;
        echo '';
        echo '';
    }
});`
    },
    {
        title: "Show Post Meta Data",
        category: "debug",
        icon: "carbon:document-tasks",
        description: "Display all custom fields/meta data for the current post.",
        code: `add_action('wp_footer', function() {
    if (current_user_can('administrator') && is_singular()) {
        $post_meta = get_post_meta(get_the_ID());
        echo '';
    }
});`
    },
    {
        title: "Display Active Plugins",
        category: "debug",
        icon: "carbon:plug",
        description: "Show a list of all currently active plugins.",
        code: `add_action('wp_footer', function() {
    if (current_user_can('administrator')) {
        $plugins = get_option('active_plugins');
        $plugin_names = array_map(function($plugin) {
            return basename($plugin, '.php');
        }, $plugins);
        echo '';
    }
});`
    },
    {
        title: "Show Current Sidebar Widgets",
        category: "templates",
        icon: "carbon:grid-view",
        description: "Display the IDs of registered sidebars and the widgets inside them.",
        code: `add_action('wp_footer', function() {
    if (current_user_can('administrator')) {
        $sidebars = wp_get_sidebars_widgets();
        echo '';
    }
});`
    },
    {
        title: "Memory Usage Tracker",
        category: "performance",
        icon: "carbon:dashboard",
        description: "Display current memory usage and peak memory usage.",
        code: `add_action('wp_footer', function() {
    if (current_user_can('administrator')) {
        echo '';
    }
});`
    },
    {
        title: "Query Monitor (Manual)",
        category: "performance",
        icon: "carbon:analytics",
        description: "Display page generation time and number of database queries.",
        code: `add_action('wp_footer', function() {
    if (current_user_can('administrator')) {
        global $wpdb;
        echo '';
    }
});`
    },
    {
        title: "Show Rewrite Rules",
        category: "debug",
        icon: "carbon:link",
        description: "Display all WordPress rewrite rules for debugging permalink issues (heavy, use with caution).",
        code: `add_action('wp_footer', function() {
    if (current_user_can('administrator')) {
        global $wp_rewrite;
        echo '';
    }
});`
    },
    {
        title: "Show Active Conditional Tags",
        category: "templates",
        icon: "carbon:tag",
        description: "Display which key conditional tags are true for the current page.",
        code: `add_action('wp_footer', function() {
    if (current_user_can('administrator')) {
        $conditionals = [
            'is_home', 'is_front_page', 'is_single', 'is_page',
            'is_archive', 'is_category', 'is_tag', 'is_search', 'is_404'
        ];
        $active = [];
        foreach($conditionals as $cond) {
            if(function_exists($cond) && call_user_func($cond)) $active[] = $cond;
        }
        echo '';
    }
});`
    },
    // --- Newly Added: Debug & Configuration ---
    {
        title: "Disable All Plugins Safely",
        category: "debug",
        icon: "carbon:plug-off",
        description: "Add to wp-config.php to temporarily disable all plugins *without* deactivating them in the database.",
        code: `define('DISABLE_PLUGINS', true);`
    },
    {
        title: "Force Admin-Only Debug Output",
        category: "debug",
        icon: "carbon:user-avatar-filled",
        description: "A utility function to print array/object output only to logged-in administrators (for functions.php).",
        code: `function wp_debug_admin_only($var) {
    if (current_user_can('administrator')) {
        echo '<pre class="admin-debug" style="background: #fff; padding: 10px; border: 1px solid #ccc; max-height: 400px; overflow: auto; color: #000; z-index: 9999; position: relative;">';
        print_r($var);
        echo '</pre>';
    }
}

// Usage: add_action('wp_footer', function() { wp_debug_admin_only(get_post()); });`
    },
    {
        title: "Increase PHP Memory Limit (wp-config.php)",
        category: "performance",
        icon: "carbon:data-blob",
        description: "Set a higher PHP memory limit (e.g., 256M) in wp-config.php before 'That's all, stop editing!'",
        code: `define('WP_MEMORY_LIMIT', '256M');`
    },
    {
        title: "Increase Max Execution Time",
        category: "performance",
        icon: "carbon:time-slot",
        description: "Increase PHP max execution time for long-running processes (e.g., large imports). Add to functions.php.",
        code: `set_time_limit(300); // 300 seconds (5 minutes)`
    },
    {
        title: "Remove WordPress Version Number (Security)",
        category: "security",
        icon: "carbon:security",
        description: "Hides the WordPress version number from the `<head>` and RSS feeds, reducing public fingerprinting.",
        code: `remove_action('wp_head', 'wp_generator');
add_filter('the_generator', '__return_false');`
    },
    {
        title: "Disable File Editing in Admin (Security)",
        category: "security",
        icon: "carbon:edit-off",
        description: "Prevents theme and plugin file editing from the WordPress admin dashboard (wp-config.php).",
        code: `define('DISALLOW_FILE_EDIT', true);`
    },
    {
        title: "Force SSL/HTTPS Login (wp-config.php)",
        category: "security",
        icon: "carbon:locked",
        description: "Forces a secure (SSL/HTTPS) connection for all administrative login and dashboard areas.",
        code: `define('FORCE_SSL_ADMIN', true);`
    },
    // --- Newly Added: Template & Content ---
    {
        title: "Force Re-save Permalinks",
        category: "templates",
        icon: "carbon:link-chain",
        description: "Use once to flush rewrite rules, fixing 404s after registering custom post types/taxonomies.",
        code: `add_action('init', 'my_flush_rewrite_rules', 10);
function my_flush_rewrite_rules() {
    flush_rewrite_rules();
}`
    },
    {
        title: "Get Custom Post Type Loop",
        category: "templates",
        icon: "carbon:repeat",
        description: "Standard loop to query and display content from a custom post type (e.g., 'product').",
        code: `<?php 
$args = array(
    'post_type' => 'product',
    'posts_per_page' => 5
);
$products = new WP_Query($args);

if ($products->have_posts()) :
    while ($products->have_posts()) : $products->the_post();
        // Display post title, content, etc.
        the_title('<h2>', '</h2>');
    endwhile;
    wp_reset_postdata(); // Restore original Post Data
endif; 
?>`
    },
    {
        title: "Remove 'Private' Prefix from Titles",
        category: "templates",
        icon: "carbon:unlocked",
        description: "Stops WordPress from adding 'Private: ' to the title of private posts.",
        code: `add_filter('private_title_format', function() {
    return '%s';
});`
    },
    // --- Newly Added: Database & Custom Data ---
    {
        title: "Fetch Specific Global Option",
        category: "database",
        icon: "carbon:settings-adjust",
        description: "Retrieve a single value from the `wp_options` table (e.g., 'blogname').",
        code: `add_action('wp_footer', function() {
    if (current_user_can('administrator')) {
        $option_value = get_option('blogname');
        echo '';
    }
});`
    },
    {
        title: "Delete All Transient Caches",
        category: "database",
        icon: "carbon:trash-can",
        description: "Use this function once (or manually via CLI) to clear transient cache data, often fixing stale data issues.",
        code: `function delete_all_transients() {
    global $wpdb;
    $wpdb->query("DELETE FROM $wpdb->options WHERE option_name LIKE '\_transient\_%'");
    $wpdb->query("DELETE FROM $wpdb->options WHERE option_name LIKE '\_site\_transient\_%'");
    // Remove the action after running once to prevent continuous execution
    remove_action('init', 'delete_all_transients');
}
add_action('init', 'delete_all_transients');`
    },
    // --- Newly Added: Hooks & Actions ---
    {
        title: "Force Remove Specific Action",
        category: "hooks",
        icon: "carbon:flow-stream",
        description: "Remove an action from a theme or plugin hook. You must know the function name and priority.",
        code: `// Example: Remove a function called 'some_plugin_function' from 'wp_head' hook, assuming priority 10
add_action('wp_loaded', function() {
    remove_action('wp_head', 'some_plugin_function', 10);
});`
    },
    {
        title: "Disable Admin Bar for Non-Admins",
        category: "hooks",
        icon: "carbon:user-access",
        description: "Hides the WordPress admin bar for all users except Administrators.",
        code: `add_filter('show_admin_bar', function($show_admin_bar) {
    if (current_user_can('administrator')) {
        return $show_admin_bar;
    }
    return false;
});`
    },
    // --- Newly Added: AJAX & REST API (New Category) ---
    {
        title: "Register Basic WP AJAX Handler",
        category: "ajax",
        icon: "carbon:api",
        description: "A boilerplate for handling a logged-in user AJAX request on the 'my_action' hook.",
        code: `// Add to functions.php
add_action('wp_ajax_my_action', 'my_ajax_handler');

function my_ajax_handler() {
    // Check nonce for security
    check_ajax_referer('my_nonce_key', 'security');

    // Process data...
    $data = sanitize_text_field($_POST['data_key']);
    $result = ['message' => 'Success!', 'received' => $data];

    wp_send_json_success($result);
    wp_die();
}`
    },
    {
        title: "Register Basic REST API Endpoint",
        category: "ajax",
        icon: "carbon:rest-api",
        description: "Register a simple, public GET REST API endpoint at '/my-namespace/v1/my-data'.",
        code: `add_action('rest_api_init', function() {
    register_rest_route('my-namespace/v1', '/my-data', array(
        'methods' => 'GET',
        'callback' => 'my_api_callback',
        'permission_callback' => '__return_true' // Public access
    ));
});

function my_api_callback(WP_REST_Request $request) {
    return new WP_REST_Response(['status' => 'ok', 'data' => 'Hello from REST API'], 200);
}`
    },
    // --- Newly Added: User & Roles ---
    {
        title: "Add New Custom User Role",
        category: "user",
        icon: "carbon:user-settings",
        description: "Register a new 'editor_lite' role with reduced capabilities. Run once then remove.",
        code: `add_action('init', function() {
    add_role(
        'editor_lite', // Role ID
        'Lite Editor', // Display name
        array(
            'read' => true,
            'edit_posts' => true,
            'delete_posts' => true,
            'upload_files' => true
        )
    );
});`
    },
    {
        title: "Remove Default User Role",
        category: "user",
        icon: "carbon:user-remove",
        description: "Remove a default role (e.g., 'Author'). Run once then remove.",
        code: `add_action('init', function() {
    if (get_role('author')) {
        remove_role('author');
    }
});`
    }
        ];

        function renderSnippets(filteredSnippets) {
            const grid = document.getElementById('snippetsGrid');
            const noResults = document.getElementById('noResults');
            
            if (filteredSnippets.length === 0) {
                grid.style.display = 'none';
                noResults.style.display = 'block';
                return;
            }
            
            grid.style.display = 'grid';
            noResults.style.display = 'none';
            
            grid.innerHTML = filteredSnippets.map((snippet, index) => `
                <div class="snippet-card">
                    <div class="snippet-header">
                        <span class="iconify snippet-icon" data-icon="${snippet.icon}"></span>
                        <div class="snippet-title">
                            <h3>${snippet.title}</h3>
                            <span class="snippet-category">${snippet.category}</span>
                        </div>
                    </div>
                    <p class="snippet-description">${snippet.description}</p>
                    <div class="code-block">
                        <pre><code>${snippet.code.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</code></pre>
                    </div>
                    <button class="copy-btn" onclick="copyCode(${index})">
                        <span class="iconify" data-icon="carbon:copy"></span>
                        Copy Code
                    </button>
                </div>
            `).join('');
        }

        function copyCode(index) {
            const code = snippets[index].code;
            navigator.clipboard.writeText(code).then(() => {
                const btn = document.querySelectorAll('.copy-btn')[index];
                const originalHTML = btn.innerHTML;
                btn.classList.add('copied');
                btn.innerHTML = '<span class="iconify" data-icon="carbon:checkmark"></span>Copied!';
                
                setTimeout(() => {
                    btn.classList.remove('copied');
                    btn.innerHTML = originalHTML;
                }, 2000);
            });
        }

        // Category filtering
        document.querySelectorAll('.category-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                
                const category = btn.dataset.category;
                const filtered = category === 'all' 
                    ? snippets 
                    : snippets.filter(s => s.category === category);
                
                renderSnippets(filtered);
            });
        });

        // Search functionality
        document.getElementById('searchInput').addEventListener('input', (e) => {
            const search = e.target.value.toLowerCase();
            const activeCategory = document.querySelector('.category-btn.active').dataset.category;
            
            let filtered = activeCategory === 'all' 
                ? snippets 
                : snippets.filter(s => s.category === activeCategory);
            
            if (search) {
                filtered = filtered.filter(s => 
                    s.title.toLowerCase().includes(search) ||
                    s.description.toLowerCase().includes(search) ||
                    s.code.toLowerCase().includes(search)
                );
            }
            
            renderSnippets(filtered);
        });

        // Initial render
        renderSnippets(snippets);
    </script>
</body>
</html>
